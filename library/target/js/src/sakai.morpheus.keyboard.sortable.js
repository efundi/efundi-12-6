$PBJQ(document).ready(function(){var a={dragModeStartMsg:"drag start, Use U and D keys to move the item up and down",dragModeEndMsg:"Drag end",newPositionMsg:"Moved to position %s"};$PBJQ.widget("sakai.keyboardSortable",$PBJQ.ui.sortable,{options:{keyboardHandle:false},_create:function(){this._super();this.options.keyboardHandle=this.options.keyboardHandle||this.options.items;this._dragging=false;this.element.on("keydown",this.options.keyboardHandle,$PBJQ.proxy(this._keydown,this));this.liveRegion=$PBJQ("<div class='ui-helper-hidden-accessible'></div>").liveregion().appendTo(document.body);this.element.find(this.options.keyboardHandle).attr({"aria-grabbed":"false","data-at-shortcutkeys":'{"u":"drag item up","d":"drag item down"}'}).blur($PBJQ.proxy(function(c){var b=$PBJQ(c.target);if(this._isDragging()){this._toggleDragMode(b,this._closestSortableNode(b))}},this)).click($PBJQ.proxy(function(c){if(c.clientX<=0||c.clientX===undefined){var b=$PBJQ(c.target);this._toggleDragMode(b,this._closestSortableNode(b))}},this))},_keydown:function(d){if($PBJQ.inArray(d.which,[27,38,40,68,85])===-1){return}if($PBJQ(d.target).is(":input")){return}d.preventDefault();var b=$PBJQ(d.target);var c=this._closestSortableNode(b);switch(d.which){case 27:if(this._isDragging()){this._toggleDragMode(b,c)}break;case 38:case 85:if(d.ctrlKey||this._isDragging()||d.which===85){this._moveBackward(c,b)}break;case 40:case 68:if(d.ctrlKey||this._isDragging()||d.which===68){this._moveForward(c,b)}break}},_closestSortableNode:function(b){var c=b.parentsUntil(this.element).last();if(!c.length){c=b}return c},_isDragging:function(){return this._dragging},_toggleDragMode:function(b,c){var d=this._isDragging();c.toggleClass("sakai-dragging",!d);if(!d){this.element.find(this.options.keyboardHandle).attr("aria-grabbed","false");this._dragging=true;b.attr("aria-grabbed","true");this._notify(a.dragModeStartMsg)}else{b.attr("aria-grabbed","false");this._dragging=false;this._notify(a.dragModeEndMsg)}},_moveBackward:function(c,d,b){$prevNode=c.prev(b);if(!$prevNode.length){return}$prevNode.insertAfter(c);this._highlightDrag(c);this._notifyPosition(c)},_moveForward:function(c,d,b){$nextNode=c.next(b);if(!$nextNode.length){return}$nextNode.insertBefore(c);this._highlightDrag(c);this._notifyPosition(c)},_highlightDrag:function(b){if(this._isDragging()){return}b.addClass("sakai-dragging-temp");setTimeout(function(){b.removeClass("sakai-dragging-temp")},1000)},_notifyPosition:function(b){var c=this.element.find(this.options.items).index(b)+1;this._notify(a.newPositionMsg.replace("%s",c))},_notify:function(b){this.liveRegion.liveregion("instance").notify(b);this._trigger("update")}});$PBJQ.widget("sakai.liveregion",{_create:function(){this.timeout=null},notify:function(b){setTimeout($PBJQ.proxy(function(){var c=$PBJQ("<div aria-live='polite'></div>").attr("role","status").appendTo(this.element);if(this.timeout){clearTimeout(this.timeout)}this.timeout=setTimeout($PBJQ.proxy(function(){c.text(b)},this),500);setTimeout($PBJQ.proxy(function(){this._clear(c)},this),10000)},this),0)},_clear:function(b){b.remove()}})});