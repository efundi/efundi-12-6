var profile=profile||{};profile.requestFriend=function(b,a,c){$PBJQ.ajax({url:"/direct/profile/"+b+"/requestFriend?friendId="+a,dataType:"text",cache:false}).done(function(e,f,d){$PBJQ("#profile-popup-request-button-"+a).hide();$PBJQ("#profile-popup-cancel-button-"+a).show();if(c){c(a)}});return false};profile.confirmFriendRequest=function(b,a,c){$PBJQ.ajax({url:"/direct/profile/"+b+"/confirmFriendRequest?friendId="+a,dataType:"text",cache:false}).done(function(e,f,d){$PBJQ("#profile-popup-incoming-block-"+a).hide();$PBJQ("#profile-popup-remove-button-"+a).show();if(c){c(a)}});return false};profile.removeFriend=function(a,c,d,b){$PBJQ.ajax({url:"/direct/profile/"+a+"/removeFriend?friendId="+c,dataType:"text",cache:false}).done(function(f,g,e){$PBJQ("#profile-popup-remove-button-"+c).hide();$PBJQ("#profile-popup-request-button-"+c).show();if(d&&b){d(c,b)}});return false};profile.ignoreFriendRequest=function(a,b,c,d){$PBJQ.ajax({url:"/direct/profile/"+a+"/ignoreFriendRequest?friendId="+b,cache:false}).done(function(f,g,e){if(c!==undefined&&c==true){$PBJQ("#profile-popup-cancel-button-"+a).hide();$PBJQ("#profile-popup-request-button-"+a).show();if(d){d(a)}}else{$PBJQ("#profile-popup-incoming-block-"+b).hide();$PBJQ("#profile-popup-request-button-"+b).show();if(d){d(b)}}});return false};profile.attachPopups=function(b,a){if(!(b instanceof $PBJQ)){console.log("profile.attachPopups takes a jQuery object array, from a selector");return}b.each(function(){var d=this.dataset.userId;var e=this.dataset.displayName;var c=$PBJQ(this).find(".profile-popup-target");var f=(c.length>0)?c.eq(0):$PBJQ(this);$PBJQ(this).qtip({position:{target:f,my:"top left",at:"bottom center",viewport:$PBJQ(window),adjust:{method:"flipinvert none"}},show:{event:"click",delay:0},style:{classes:"profile-popup-qtip qtip-shadow"},hide:{event:"click unfocus"},content:{text:function(h,g){return $PBJQ.ajax({url:"/direct/portal/"+d+"/formatted",cache:false}).then(function(i){return i},function(k,i,j){g.set("content.text",i+": "+j)})}},events:{visible:function(k,i){var g=$PBJQ("#profile-popup-request-button-"+d);g.on("click",function(n){profile.requestFriend(portal.user.id,d)});var l=$PBJQ("#profile-popup-cancel-button-"+d);l.on("click",function(n){profile.ignoreFriendRequest(d,portal.user.id,true)});var h=$PBJQ("#profile-popup-accept-button-"+d);h.on("click",function(n){profile.confirmFriendRequest(portal.user.id,d)});var m=$PBJQ("#profile-popup-ignore-button-"+d);m.on("click",function(n){profile.ignoreFriendRequest(portal.user.id,d,false)});var j=$PBJQ("#profile-popup-remove-button-"+d);j.on("click",function(n){profile.removeFriend(portal.user.id,d)});if(a){if(a.connect){g.off("click").on("click",function(n){var o=function(p){a.connect(p);i.destroy()};profile.requestFriend(portal.user.id,d,o)})}if(a.cancel){l.off("click").on("click",function(n){var o=function(p){a.cancel(p);i.destroy()};profile.ignoreFriendRequest(d,portal.user.id,true,o)})}if(a.accept){h.off("click").on("click",function(n){var o=function(p){a.accept(p);i.destroy()};profile.confirmFriendRequest(portal.user.id,d,o)})}if(a.ignore){m.off("click").on("click",function(n){var o=function(p){a.ignore(p);i.destroy()};profile.ignoreFriendRequest(portal.user.id,d,false,o)})}if(a.remove){j.off("click").on("click",function(n){var o=function(q,p){a.remove(q,p);i.destroy()};profile.removeFriend(portal.user.id,d,o,e)})}}}}})})};