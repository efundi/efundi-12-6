var sessionId="current";var sessionTimeOut;var timeoutDialogEnabled=false;var timeoutDialogWarningTime;var timeoutLoggedoutUrl;var timeoutPortalPath;$PBJQ(document).ready(function(){if(portal.loggedIn&&portal.timeoutDialog){setTimeout("setup_timeout_config();",60000)}});var setup_timeout_config=function(){timeoutDialogEnabled=portal.timeoutDialog.enabled;timeoutDialogWarningTime=portal.timeoutDialog.seconds;timeoutLoggedoutUrl=portal.loggedOutUrl;timeoutPortalPath=portal.portalPath;if(timeoutDialogEnabled==true){poll_session_data();fetch_timeout_dialog()}};var poll_session_data=function(){$PBJQ.ajax({url:"/direct/session/"+sessionId+".json?auto=true&_="+(new Date()).getTime(),dataType:"json",success:function(b){b.maxInactiveInterval=b.maxInactiveInterval*1000;if(b.active&&b.userId!=null&&b.lastAccessedTime+b.maxInactiveInterval>b.currentTime){var a=b.lastAccessedTime+b.maxInactiveInterval-b.currentTime;if(a<timeoutDialogWarningTime*1000){min=Math.round(a/(1000*60));show_timeout_alert(min);clearTimeout(sessionTimeOut);sessionTimeOut=setTimeout("poll_session_data()",1000*60)}else{clearTimeout(sessionTimeOut);sessionTimeOut=setTimeout("poll_session_data()",(a-timeoutDialogWarningTime*1000))}}else{if(b.userId==null){location.href=timeoutLoggedoutUrl}else{sessionTimeOut=setTimeout("poll_session_data()",1000*10)}}},error:function(c,a,b){}})};function keep_session_alive(){dismiss_session_alert();$PBJQ.get(timeoutPortalPath)}var dismiss_session_alert=function(){removeDHTMLMask();$PBJQ("#timeout_alert_body").remove()};var timeoutDialogFragment;function fetch_timeout_dialog(){$PBJQ.ajax({url:"/portal/timeout?auto=true",cache:true,dataType:"text",success:function(a){timeoutDialogFragment=a},error:function(c,a,b){timeoutDialogEnabled=false}})}function show_timeout_alert(b){if(!timeoutDialogEnabled){return}if(!$PBJQ("#portalMask").get(0)){createDHTMLMask(dismiss_session_alert);$PBJQ("#portalMask").css("z-index",1000)}if($PBJQ("#timeout_alert_body").get(0)){$PBJQ("#timeout_alert_body span").html(b)}else{var a=timeoutDialogFragment.replace("{0}",b);$PBJQ("body").append(a)}};